© 2002 Wiley-Liss, Inc.

Cytometry 49:12–21 (2002)

Confocal DNA Cytometry: A Contour-Based Segmentation Algorithm for Automated Three-Dimensional Image Segmentation
Jeroen A.M. Belien,* Hielke A.H.M. van Ginkel, Paulos Tekola, Lennert S. Ploeger, Neal M. Poulin, ¨ Jan P.A. Baak, and Paul J. van Diest
Department of Pathology, VU Medical Center, Amsterdam, The Netherlands
Received 20 February 2002; Revision Received 13 May 2002; Accepted 18 June 2002

Background: Confocal laser scanning microscopy (CLSM) presents the opportunity to perform three-dimensional (3D) DNA content measurements on intact cells in thick histological sections. So far, these measurements have been performed manually, which is quite time-consuming. Methods: In this study, an intuitive contour-based segmentation algorithm for automatic 3D CLSM image cytometry of nuclei in thick histological sections is presented. To evaluate the segmentation algorithm, we measured the DNA content and volume of human liver and breast cancer nuclei in 3D CLSM images. Results: A high percentage of nuclei could be segmented fully automatically (e.g., human liver, 92%). Comparison with (time-consuming) interactive measurements on the same CLSM images showed that the results were well correlated (liver, r 1.00; breast, r 0.92).

Conclusions: Automatic 3D CLSM image cytometry enables measurement of volume and DNA content of large numbers of nuclei in thick histological sections within an acceptable time. This makes large-scale studies feasible, whereby the advantages of CLSM can be exploited fully. The intuitive modular segmentation algorithm presented in this study detects and separates overlapping objects, also in two-dimensional (2D) space. Therefore, this algorithm may also be suitable for other applications. Cytometry 49:12–21, 2002.
© 2002 Wiley-Liss, Inc.

Key terms: confocal laser scanning microscopy; 3D reconstruction; DNA ploidy; cytometry; tissue; segmentation

Image (static) cytometry is being accepted more as an important technique for measuring geometrical, cytochemical, histochemical, and molecular cell or tissue features (1–3). Contrary to ﬂow cytometry, it allows selective measurements of speciﬁc nuclei based on the morphology of nuclei and cells. Image cytometry can be performed on imprints or cytospins, which contain whole nuclei on which highly accurate measurements can be performed. However, tissue architecture is lost and in case of a small tumor it may be impossible to measure DNA ploidy, or other substances, becuase the relevant cells may be lost within irrelevant cell populations (e.g., ﬁbroblasts, inﬂammatory cells). Alternatively, measurements can be done within the preserved tissue architecture of tissue sections. However, an important disadvantage of image cytometry in tissue sections is that cutting tissue sections at 4 – 6 m results in cutting artifacts as the diameter of nuclei is generally larger than 4 m. This is an important obstacle for accurate measurement of DNA content of nuclei in tissue sections. Cutting artifacts can be reduced by increasing the thickness of the sections, but this results in

overlap, blurred microscope images, and less accurate measurements (4 – 6). These problems can be solved by using confocal laser scanning microscopy (CLSM) instead of conventional light microscopy. CLSM makes it possible to obtain thin optical slices within thick sections, where cutting artifacts are eliminated. This optical sectioning is due to the confocal principle, whereby emitted light, which does not originate from the current focal plane, is eliminated. By recording a series of consecutive two-dimensional (2D) optical slices, three-dimensional (3D) reconstructions can be made using digital image processing and a variety of 3D features can be quantiﬁed (7–11; Fig. 1).

Grant sponsor: Praeventiefonds; Grant number: 28/1814. *Correspondence to: Dr. Jeroen A.M. Belien, Department of Pathology, ¨ VU Medical Center, P.O. Box 7057, 1007 MB Amsterdam, The Netherlands. E-mail: jam.belien@vumc.nl Published online in Wiley InterScience (www.interscience.wiley.com). DOI: 10.1002/cyto.10138

3D CLSM CONTOUR-BASED SEGMENTATION ALGORITHM

13

FIG. 1. Overview of the optical slices and their corresponding segmentations of a nucleus measured (images on the left). The ﬁrst group of three columns (p_obj) are the original grey-value images of the cell with a single pixel contour and the second group of three columns (c_obj) show the segmentation results from which the contours shown in the ﬁrst three columns were derived. Lower right corner: an imperfect delineation is modiﬁed interactively with a mouse. In the optical slice in the upper right corner, the measurement results of the inspected nucleus (marked by a rectangle) are shown. Note that all measured nuclei are labeled.

For example, the DNA content of a nucleus in a 3D CLSM image can be determined by staining the tissue with a stoichiometric DNA binding ﬂuorescent dye, segmenting the nuclear proﬁles in each optical section and summing the nuclear integrated ﬂuorescence intensity of all relevant sections. Thereby, 3D CLSM-based DNA image cytometry has all the advantages of DNA image cytometry without the disadvantages of 2D measurement procedures. In a previous study (12), we developed staining procedures for parafﬁn-embedded tissue for two DNA-speciﬁc, highly sensitive, stoichiometric and stable ﬂuorochromes, TOTO-1 and YOYO-1 iodide. These stains are perfectly suitable for CLSM as their wavelengths of maximal absorption, 491 and 514 nm, respectively, closely match the 488 and 514-nm lines of the argon laser. Most commercially available CLSMs are equipped with this laser. Interactive 3D CLSM measurements of 1 N spermatozoa, 2 N, 4 N, and 8 N human and rat liver nuclei, and 3 N aneuploid breast cancer nuclei stained with YOYO-1 iodide showed good linearity (12,13). Due to their high stability, the use of TOTO-1 or YOYO-1 iodide eliminates most of the problems caused by photobleaching. A high quality stain like YOYO-1 produces very highly contrasting images, facilitating the segmentation of nuclei. The actual segmentation of CLSM images can be obtained by interactive or automatic algorithms. Interactive methods, based on drawing with a mouse around nuclei in sequence (8,13,14), or orthogonal (15) 2D slices are still superior in performance (deﬁned as the fraction of nuclei correctly segmented) based on visual judgment of the results compared with automatic algorithms. Therefore,

they still serve as the gold standard when new automated segmentation algorithms are presented. Although interactive segmentation is simple and generally applicable, it is very time-consuming, monotonous, and demands constant precision from the operator. Therefore, these interactive measurements may not be feasible for applications that require many objects to be measured. However, due to the heterogeneity within tumor tissue, many applications (e.g., DNA ploidy measurements in tumor specimens) require large numbers of objects to be measured to reduce the impact of selection bias on the measurement results and to achieve acceptable levels of signiﬁcance. For these reasons, (semi-) automatic segmentation and identiﬁcation algorithms have been developed (8,15–22). Rigaut et al. (8) and Irinopoulou et al. (18) developed an automated algorithm in which nuclear proﬁles are segmented using a global threshold and mathematical morphology operations. Clusters of objects are separated by combining a distance transformation with a watershed algorithm (23). A deagglomeration algorithm based on convexity criteria, percentage of common surface, and monotone increase or decrease solved the problem of overlapping or touching objects in the Z-direction. Using this algorithm, these authors (8,18) measured the volume and DNA content of prostate nuclei, with corresponding coefﬁcients of variation (CV) of 18.4 –33.5% and 9.0 – 12.0%. Results on the percentage of correctly segmented nuclei without user interaction are not given, although their original algorithm (8) automatically segmented rat liver nuclei, but not nuclei in 60- m sections of human in situ carcinoma of the esophagus.

14

¨ BELIEN ET AL.

Roysam et al. (16), Ancin et al. (17), and Mackin et al. (24) developed a segmentation algorithm that was used for CLSM and for wide-ﬁeld microscopy. These authors applied an initial global segmentation algorithm on gradient processed images, followed by a locally adaptive threshold and separate connected objects using a 3D watershed or cluster analysis algorithm. Ancin et al. (17) reported 92% correct segmentation on rat liver, but did not report results for the hippocampal brain region of the rat, where nuclei are packed more densely. Applying a similar version of the algorithm for thick and overlapped clusters in cytologic preparations resulted in 76% and 45% correctly segmented nuclei in clusters from normal and abnormal smears, respectively (24). The work of Lockett et al. (15), de Solorzano et al. (20), and Sarti et al. (21) is based on applying an adaptive, gradient-weighted average threshold. The user classiﬁes each object segmented interactively. Objects classiﬁed as clusters are divided iteratively into subcomponents using a distance transform and a watershed algorithm. The percentage of correctly segmented nuclei, including the interactive classiﬁcation of objects, ranged from 98% for Caenorhabditis elegans to 66% for invasive breast carcinoma (20). By applying partial-differential-equation– based ﬁltering as preprocessing and postprocessing strategies, Sarti et al. (21) expected to improve their initial segmentation results because nuclear surfaces were substantial and measurably improved. However, they did not provide data on the overall improvement of their initial segmentation method. Rodenacker et al. (19) presented a method, which was based on thresholding followed by 3D volume visualization and interactive division of clusters of nuclei by a seeded volume growing technique. Division was performed by marking manually the centers of nuclei. This was followed by automatic region growing from the markers, which was limited by size and shape constrains, and ﬁnal manual reﬁnement by ﬁtting the nuclei to ellipsoidal model. Adiga et al. (22) improved this initial algorithm by developing a region-based segmentation method involving a watershed algorithm to separate clustered objects, followed by a rule-based merging technique to reduce the oversegmentation of cells caused by the watershed algorithm. Applying their method to prostate cancer specimens resulted in 95% correctly segmented nuclei. The performance of these semiautomatic methods is generally high ( 90%) for specimens containing wellseparated nuclei. Performance signiﬁcantly deteriorates for many cancer specimens due to their complex and crowded spatial organization. All of these aforementioned algorithms try to split the clustered objects based on some form of the watershed algorithm. We present a segmentation algorithm for automated 3D image segmentation that attempts to solve the problem of clustered nuclei in cancer specimens. In contrast to the algorithms discussed, our proposed algorithm does not use the watershed algorithm to split clustered objects, but tries to split clustered objects based on indentations along their contours. We emphasize the performance of auto-

matic versus interactive 3D CLSM image cytometry of nuclei rather than the accuracy of (DNA ploidy measurements with) 3D CLSM image cytometry, the results of which were reported already (13). Therefore, the DNA content and volume of nuclei in 20- m–thick parafﬁn sections of human liver and breast cancer tissue were measured. The 3D segmentation of the liver nuclei should result in spherical volumes and the resulting DNA histogram should contain narrow peaks at exactly 2C, 4C, and 8C. Contrary to liver tissue, human breast cancer tissue may contain nuclei of irregular shape that are often close together, increasing the complexity of the segmentation process. To avoid the problem of attenuation of ﬂuorescence intensity with tissue depth, which mainly affects CLSM image slices obtained from deeper layers within the specimen, only relatively thin (20 m) histological sections were used (13,25). MATERIALS AND METHODS Specimen Preparation Material from human liver and breast cancer tissue was ﬁxed in 4% neutral-buffered formalin and embedded in parafﬁn according to standard procedures. In each of the two parafﬁn blocks, a 20- m thick section was cut and mounted on a poly-L-lysine– coated slide. The sections were deparafﬁnized in Xylol for 8 h, rehydrated in alcohol in decreasing concentrations, and rinsed in running distilled water. Next, hydrolysis was performed in 2 N HCl solution for 25 min at 27°C and the sections were rinsed again in running distilled water. The sections were stained in the dark for 1 h with YOYO-1 iodide (Molecular Probes, Eugene, OR; 26,27). YOYO-1 iodide (1 mM) was ﬁrst diluted (1:2,000) in a solution of phosphate-buffered saline (PBS; pH 7.2) and distilled water to which 200 l 0.1 N HCl was added (12). Each stained section was dehydrated in alcohol in increasing concentrations and mounted in Fluoromount (Gurr, London, UK; 12). Acquisition of the 3D CLSM Images In each thick tissue section, four 3D images were recorded with a Zeiss LSM-10 confocal laser scanning microscope (Zeiss, Oberkochen, Germany), using the 488-nm argon laser line, a 40/1.3 oil objective, and an electronic zoom factor of 40. The 3D CLSM images consisted of a series of 40 consecutive optical slices perpendicular to the optical axis with an interval of 0.42 m (this is the distance between two slices if the stage moves 0.5 m in the axial direction, after correction for refraction; 28). Fluorescent latex microspheres (excitation 488 nm) embedded in the same mounting medium as used for the histological sections were used to calibrate the confocal system. The 3D image slices were transported directly from the CLSM through the CCIR/PAL video channel to a Sun SPARC-2 workstation (Sun Microsystems, Mountain View, CA) equipped with a Data Cell S2200 frame grabber (DIFA Measuring Systems, Breda, The Netherlands) for digitization. After transportation, the optical slices of the 3D CLSM images consisted of 640 480 pixels (picture

3D CLSM CONTOUR-BASED SEGMENTATION ALGORITHM

15

elements), corresponding to a size of 147.2 110.4 m. Each pixel corresponded to a size of 0.23 0.23 m with an intensity value between 0 and 255. The 3D image processing was performed on a Sun SPARC-2 workstation using software developed with the image processing software package SCIL_Image (DIFA Measuring Systems). The images were stored on an optical disc. 3D CLSM-Based DNA Image Cytometry Our 3D CLSM image cytometer enables measurement of the DNA content and volume of nuclei in 3D CLSM images. Previously, this was done interactively as follows (13): The operator clicks in one of the optical slices of the 3D CLSM image at the nucleus to be measured, after which this part of the optical slice is enlarged in an auxiliary image. The operator segments the nucleus in this image by delineating its proﬁle with a mouse. The same regions of interest of the slices below successively appear for segmentation until the slice is reached in which the nucleus is no longer visible. The same process continues from the initial slice upward until the nucleus is segmented in all optical slices. After segmenting a complete nucleus, its volume is calculated by summing the area of its 2D proﬁles and multiplying this by the interval between the optical slices (0.42 m; Cavellari’s principle). Analogously, the DNA content is quantiﬁed by integrating the ﬂuorescence intensity over the volume (11). Finally, the numerical results and an overview of all optical slices of the nucleus, together with their delineated proﬁles, are presented to the operator (Fig. 1). If necessary, imperfect delineations are modiﬁed. Several nuclei are measured to obtain, for example, a DNA histogram. Note that, in order to be complete, segmented nuclei are not allowed to touch any border of the 3D CLSM image. Flow of Automated Segmentation Algorithm The ﬂow of processing for the entire image stack begins with the initial rough segmentation of an optical slice from about the center of the image stack (e.g., the 20th slice for breast images). 1. A global intensity threshold is determined using the isodata algorithm (29). This is an iterative procedure that divides the image into brighter object pixels and darker background pixels. 2. After threshold segmentation, separated and clustered objects are labeled in the central optical slice. Rough segmentation is completed by ﬁlling in holes in the thresholded objects. The initial object contours are obtained from this threshold segmentation. 3. The segmentation of the central optical slice is reﬁned using the contour-based segmentation algorithm. This algorithm uses information on the curvature of the object contours to separate clustered objects. Details of this operation are described in the next section. 4. The objects identiﬁed in this segmentation of the center optical slice are used to direct further processing of the image stack. For each labeled object, the intensity threshold is reﬁned further using a locally adaptive thresh-

old procedure. A locally adaptive procedure is mandatory because the intensity of the nuclear regions across the image, and especially in the axial direction, is not constant. For this purpose, the isodata algorithm is used again, but only within the region of interest immediately surrounding the object. 5. For each object in the central slice, segmentation proceeds up through the optical slices. In the next neighboring slice, the isodata threshold is obtained for the region of interest. Contour-based segmentation is performed on the objects identiﬁed in this region, which may be split into several separated object parts as a result. 6. The algorithm attempts to join object parts that overlap signiﬁcantly with the object in the previous slice (e.g., more than 80% overlap). This process is repeated for the given cluster, stepping upward through the image stack, and referring to overlaps with the object deﬁned from the analysis of the previous slice. 7. For the given cluster, the process is repeated, starting from the center and stepping in the downward direction, until all possible objects are resolved. 8. The entire process is repeated for the next object deﬁned in the central optical slice. Contour-Based Segmentation The algorithm for automatic segmentation of the individual nuclear proﬁles is based on the optical advantages of CLSM. First, due to the confocal principle, the optical slices of a CLSM image are very thin, which prohibits severe overlap. This means that it should be possible to detect and separate overlapping or touching objects given the shape of their joint contours. Second, previous segmentation results in optical slices above and below the current optical slice can be used to arrive at a correct segmentation. A nuclear proﬁle is segmented automatically in an optical slice as follows (Fig. 2):

FIG. 2. Automatic segmentation of a nucleus in an optical slice. A: The nucleus to be segmented. B: Rough segmentation of A. C: Object after restricted convex hull operation. The lighter grey pixels were added to the object. D: Contour pixels of the indentations. Each indentation is shown in a different grey tone. E: Distance transform. Pixels located deeper in the object have higher grey values. F: Indentation pixels matched to those of the distance transform of the restricted convex hulled object to obtain the deepest points. G: Object parts after separation. The detected indentations are marked. H: The resulting segmentation after merging object parts, given the previously segmented proﬁle.

16

¨ BELIEN ET AL.

1. Initially, the nuclear proﬁle is segmented roughly by thresholding (Fig. 2B). The resulting objects that do not overlap with the previously segmented nuclear proﬁle of the previous slice are removed and possible holes in the objects are ﬁlled. 2. Indentations in the contours of the objects are detected. Because severe overlap is excluded, indentations will (almost certainly) be present where nuclei overlap. To detect the indentations of an object, they are ﬁlled initially using an operation known as a “restricted convex hull,” or “rhull” (Fig. 2C). This operation draws a straight line between all contour pixel pairs, which are separated by a Euclidean distance less than or equal to R (for this study R 8 pixels). Background pixels found on those lines are added to the object. The value of R determines the sensitivity of the detection method and is set so that three small nuclei will be separated even if they touch each other optimally. 3. The contour pixels of the indentations are obtained using basic image arithmetic operations (Fig. 2D). The deepest point of each indentation is determined by matching the values of the indentation pixels to those of the distance transform of the “rhulled” object (Fig. 2E). The distance transform assigns a value to each object pixel corresponding to its distance to the contour. For each indentation, the pixel with the highest value of the distance transform is chosen as the deepest point (Fig. 2F). The indentations are ordered given their depth. The detected indentations are shown in Figure 2G. Note that for the detection of the indentations, parameters can be set according to the minimal size and depth of the indentations and the maximum number of indentations. The minimum size and depth of the indentations are set at values that will skip indentations caused by small irregularities in the contour of objects. The maximum number of indentations is set empirically at a value of 10. More indentations were only found when debris was involved in clustered objects. 4. Two parameters are deﬁned for pairs of indentations that deﬁne the possible boundary between overlapping nuclei: (a) the Euclidean distance between two indentations (shortest distance) and (b) the ratio between this shortest distance and the distance along the contour (shortest/contour distance ratio). Indentations are coupled if both these parameters are smaller than certain maxima (set at 30, approximately 7 m, and 0.5, respectively, in this study). The shortest distance parameter is related to the size of the smallest nuclei to be measured. If the parameter is set at a higher value, small nuclei may almost entirely overlap each other, which according to the confocal principle could not be the case. Consequently, some of the detected indentations may not be used. 5. The objects are separated into parts by drawing lines between the coupled indentations. We implemented three separation modes: (1) separation lines are drawn between all coupled indentations, (2) if an indentation is coupled to more than one other indentation, a separation line is drawn only to the indentation corresponding to the

lowest shortest/contour distance ratio, and (3) a separation line is drawn only between those coupled indentations that have each other as the corresponding lowest shortest/contour distance ratio. The object parts, obtained using separation mode 3, are shown in Figure 2G. 6. Parts that completely or for the most part overlap with the previously segmented nuclear proﬁle are associated with each other to compose the 3D segmented object. The object parts are connected with each other by a closing operation. A parameter can be set, indicating the percentage for each object part that should overlap the previously segmented proﬁle. For this study, this parameter was set empirically at 80%. The resulting segmentation is shown in Figure 2H. General Segmentation Considerations 1. The operator does not have to be present during the automatic measurement of the nuclei, but should inspect the results (Fig. 1). 2. If certain nuclei cannot be measured automatically due to initial segmentation errors in the center optical slice, the operator can restart the procedure in a deeper optical slice and automatic measurement may then succeed when they are selected again. Initial proﬁles belonging to nuclei already successfully measured are skipped. 3. Nuclei skipped during the automatic measurement process may be measured interactively afterward. 4. When two clumping cells appear exactly behind each other in the axial direction, it may be very difﬁcult to determine the exact border between them, i.e., the slice where the upper nucleus disappears and the lower nucleus appears. Therefore, if the number of intersecting optical slices of a nucleus exceeds a maximum number of slices per nucleus, the object is split at the slice where its integrated ﬂuorescence intensity shows a local diminution (this gives a better performance than splitting the object where it shows a narrowing of its contours). Statistical Analysis Correlations between interactively and automatically obtained nuclear DNA content were compared with linear regression analysis, registering correlation coefﬁcient r, and the intercept with the y-axis and slope of the regression line to detect systematic differences. RESULTS The DNA content and volume of all complete nuclei (181 nuclei for human liver specimens and 255 nuclei for breast cancer specimens) intersecting the 15th and 20th slice of the recorded 3D CLSM images were measured automatically with or without correction. Nuclei that were not measured automatically were added interactively. All nuclei that were measured automatically were measured interactively as well to compare measurement results. There were high correlations between the automatic and interactive measurement results of DNA content (liver: r 1.00, y 1.00*x 0.59; breast: r 0.92,

3D CLSM CONTOUR-BASED SEGMENTATION ALGORITHM

17

FIG. 3. Results of linear regression analysis on measurement of DNA content of human liver and human breast cancer tissue. Circle, nuclei that were correctly segmented automatically; triangle, nuclei that showed small segmentation errors. The results without correction of these segmentation errors are shown; square, nuclei that were not segmented automatically and were measured interactively; a.u., arbitrary units. Top: y 1.00*x 0.59; bottom: y 0.87*x 185.34.

y 0.87*x 185.34) without large systematic differences (Fig. 3). The measurement results for all nuclei are shown in Figure 4. Note the high correlation between DNA content and volume (liver: r 0.91, y 0.13*x 90.75; breast cancer: r 0.83, y 0.16*x 86.31). Figure 5 shows that the measured nuclei, in the upper layers of the 3D CLSM images, did not show a relevant decrease of DNA content with tissue depth due to the problem of attenuation of

FIG. 4. DNA content and volume of individual nuclei measured in 3D CLSM images of human liver (top) and breast cancer tissue (bottom). Circle, nuclei (n 146, top; n 82, bottom) that were correctly segmented automatically; triangle, nuclei (n 20, top; n 65, bottom) that showed small segmentation errors. The results without correction of these segmentation errors are shown; square, nuclei (n 15, top; n 108, bottom) that were not segmented automatically and were measured interactively. Top: y 0.13*x 90.75; bottom: y 0.16*x 86.31.

18

¨ BELIEN ET AL.

FIG. 6. 3D reconstruction of the measured nuclei in one of the 3D CLSM images of human liver. The 2 N, 4 N, and 8 N nuclei are appear medium grey, dark grey, and white (the two largest nuclei), respectively. Note that only the nuclei intersected by the 15th and 20th slice are measured and shown.

FIG. 5. Nuclear DNA content versus tissue depth in 3D CLSM images of human liver (top) and breast cancer tissue (bottom). Note that there is no relevant attenuation of ﬂuorescence intensity with tissue depth. The different 2 N, 4 N, and 8 N DNA ploidy populations are visible in human liver, also illustrating the linearity of the system.

showing segmentation errors and their corrections (DNA content: r 1.00, y 1.00*x 6.57; volume: r 0.99, y 0.99*x 9.35) was very high without systematic differences. In the 3D CLSM breast cancer images, 57.6% were measured automatically, of which 44.2% showed small segmentation errors. Similarly as for the liver tissue, corrections did not change signiﬁcantly the measurement results, although the differences are larger. The correlation between the nuclei showing segmentation errors and their corrections (DNA content: r 0.81, y 0.72*x 421.84; volume: r 0.78, y 0.65*x 112.32) was high and the DNA content and volume of automatically segmented nuclei were underestimated systematically. Another important result was that the DNA indices (DIs) and CVs of the DNA histograms for the human liver and breast cancer tissue did not change signiﬁcantly (Table 1) when nuclei that could not be segmented automatically, but were measured interactively, were added to the measure-

ﬂuorescence intensity. Figure 6 shows a 3D reconstruction of the measured nuclei in one of the 3D CLSM images of the human liver tissue. The best performance of the automatic segmentation algorithm was obtained by detecting many indentations (i.e., a small value for R of the restricted convex hull operation) and separating nuclei only by coupled indentations having each other as lowest shortest/contour distance ratio (separation mode 3). Figure 7 shows a 3D reconstruction of the measured nuclei in one of the 3D CLSM images of the breast cancer tissue. Nuclei that were segmented automatically appear light grey. In the 3D CLSM human liver images, 91.7% of the nuclei were measured automatically. Of these nuclei, 11.4% showed small segmentation errors. However, interactive correction of these segmentation errors did not change signiﬁcantly the measurement results. The correlation between the nuclei

FIG. 7. 3D reconstruction of the measured nuclei in one of the 3D CLSM images of breast cancer tissue. The nuclei that were segmented automatically appear light grey. Note that only the nuclei measured are shown.

3D CLSM CONTOUR-BASED SEGMENTATION ALGORITHM

19

Table 1 DI and CV of the DNA Histograms for Human Liver and Breast Cancer Tissue, Respectively, Without and With Correction of the Segmentation Errors and Inclusion of the Nuclei That Were not Segmented Automatically by Measuring Them Interactively* Human liver DI 1.936 1.942 1.940 Breast cancer DI — — —

No. Automatically without correction Automatically with correction Including nonautomatically segmented nuclei 166 166 181

CV 14.69 14.49 14.96

No. 147 147 255

CV 21.38 19.70 22.09

*Because only 2 N breast cancer nuclei were measured, no DI was calculated for the breast cancer tissue.

ment set. In the recorded 3D CLSM images of the breast cancer tissue, only diploid nuclei were present. Therefore, no DI was calculated for the breast cancer tissue with 3D CLSM-based DNA cytometry. With ﬂow cytometry, breast cancer tissue of the same parafﬁn block was interpreted as diploid as well (DI 1, CV 3.97). The population of tetraploid nuclei was very small. Measuring a single nucleus automatically decreased the measurement time by approximately a factor 4. The automatic measurement speed is highly dependent on the percentage of nuclei that is automatically segmented, as it takes time to determine this result. Therefore, the automatic measurement speed for human liver nuclei was considerably higher than for breast cancer nuclei. DISCUSSION Our goal was to develop an automatic CLSM-based 3D image cytometer capable of measuring large numbers of nuclei in thick histological sections. Therefore, given the optical advantages of CLSM, we developed an automatic segmentation algorithm based on the contours of objects. However, despite the confocal principle, we observed a considerable amount of out-of-focus noise present in the 2D optical slices of the 3D CLSM images, so that the axial resolution was above the theoretical minimum of 0.35 m (30 –32). As a result, the nuclei in the optical slices may still show a considerable degree of overlap, causing ﬂuorescence intensity of other nuclei being partly integrated when determining their DNA content and resulting in measurement errors. Consequently, the application of 3D CLSM image restoration techniques, which artiﬁcially decrease the thickness of the optical slices, may be a prerequisite for DNA ploidy measurements in tissue where nuclei are close together (33). Currently, deconvolutionbased restoration techniques for 3D CLSM images often require large amounts of computer memory. In addition, they are time-consuming (especially when large images are used as in this study), complicated, and do not always give satisfactory results. This deserves further investigation. The acquisition of 3D images with the CLSM is subject to many undesirable effects, increasing the complexity of restoration. These undesirable effects are caused by aberrations in the optical path of the microscope (34), nonuniform distribution of the excitation laser and detected emission light (35), refractive index mismatches (36), bleaching, tissue destruction, Rayleigh and Raman scatter-

ing (37), and autoﬂuorescence. In addition, attenuation of ﬂuorescence intensity with depth, due to absorption and diffraction of the laser and emitted ﬂuorescence light in the case of thick parafﬁn sections (8,25,35), poor penetration, and nonuniforn distribution of the ﬂuorochrome(s) over the specimen are other sources of error. However, restoration techniques are being developed, are becoming less time-consuming and cheaper, and probably will be applicable as an integrated part of CLSMs in the near future (38). The application of these restoration techniques will also increase the performance of the automatic segmentation algorithm. Despite the aberrations, the contour-based automatic segmentation algorithm presented in this study performed surprisingly well. Fifty-eight percent of the breast cancer nuclei and 92% of the human liver nuclei were measured automatically. We also measured the human liver tissue to compare our segmentation results with those of others because most algorithms were tested on this type of tissue. The contour-based segmentation results are comparable to results obtained with other algorithms on comparable tissues (17,20,24). The contour-based segmentation algorithm strongly depends on the proper detection of the indentations. Not applying deconvolution algorithms resulted in a large number of nuclei severely overlapping each other, which should not be possible according to the confocal principle. This hampered the detection of proper indentations and, therefore, the ﬁnal segmentation result. The percentage of automatically segmented cancer nuclei should improve once the proper deconvolution algorithms are applied. The measurement speed compared with earlier studies increased (11,13). Operator interaction time was reduced considerably. This may decrease even more when inspection and correction are omitted. The results (Table 1) suggest that the interactive measurement of the nonautomatically segmented nuclei, the correction of the erroneously segmented nuclei, and the inspection of the automatically measured nuclei do not change signiﬁcantly the measurement results. Based on these results, we may be able to skip the time-consuming inspection and interactive measurement for measurement of DNA content if the CVs of the detected peaks in the histogram are small enough. The automatic segmentation algorithm can also be used interactively by allowing it to generate suggestions for the delineations of the nuclear proﬁles in each optical slice.

20

¨ BELIEN ET AL.

This will speed up interactive measurements considerably, as the automatic segmentation algorithm will give satisfactory results for almost all nuclear proﬁles, even those nuclei that cannot be segmented automatically. This mode of operation is comparable with the segmentation algorithm described by Lockett et al. (15). The presented algorithm uses well-known, intuitive, high-level image processing operations, which makes the segmentation process user friendly and ﬂexible. The effect of each parameter on the segmentation process is easy to understand. The automatic segmentation algorithm can be divided into separate modules corresponding to the different stages of the segmentation process. Due to its modularity, parts of it can be combined easily with other segmentation techniques. This makes the algorithm very suitable for other applications. Most segmentation methods can be divided primarily into region-based and boundary-based approaches. Region-based methods rely on the fact that variations of spatially localized features within an object are smaller, compared with other regions in the image, and are less susceptible to noise. The main problem is that the ﬁnal result strongly depends on the choice of seed-points, which will dictate strongly the region’s shape. Therefore region-based methods are prone to oversegmentation. This is true of the watershed algorithm used by most groups (8,15–22) and for the contour-based algorithm described in this study. When many nuclei are clustered together and some of them have irregular shapes, our algorithms oversegment some of the clustered nuclei due to erroneous detection of the indentations. A potential solution is to deﬁne the shape and other distance parameters to classify the indentations and to throw away indentations that are not due to nuclear overlap. In contrast to region-based methods, boundary-based methods primarily use gradient information to locate object boundaries (edges). These algorithms often result in false or broken edges and are more sensitive to noise (17). Shape variations can be better handled using deformable boundary-ﬁnding algorithms. A particular advantage of this approach, which may be regarded as a “2.5D” segmentation method, is that it incorporates object information from the previous optical slice to merge objects that may be oversegmented. Therefore, exact initial segmentation of the central optical slice may lead to superior results. In future studies, we will integrate a variety of methods because we expect that the complementary strengths of both region and boundarybased methods will lead to optimal results. LITERATURE CITED
1. Belien JAM, Somi S, de Jong JS, van Diest PJ, Baak JPA. Fully automated microvessel counting and hot spot selection by image processing of whole tumour sections in invasive breast cancer. J Clin Pathol 1999;52:184 –192. 2. Belien JAM, Baak JPA, van Diest PJ, van Ginkel AHM. Counting mitoses by image processing in Feulgen stained breast cancer sections: the inﬂuence of resolution. Cytometry 1997;29:189. 3. Belien JAM, Baak JPA, van Diest PJ, van Ginkel AHM. Counting mitoses by image processing in Feulgen stained breast cancer sections: the inﬂuence of resolution. Cytometry 1997;28:135–140.

4. Sapi Z, Hendricks JB, Haris PG, Wilkinson EJ. Tissue section imageanalysis of breast neoplasms — evidence of false aneuploidy. Am J Clin Pathol 1993;99:714 –720. 5. Sperb RA, Arnold W, Bahr GF, Loning T, Gebbers JO. Comparative DNA image cytometry in imprint-secretion, cytospin-secretion and tissue section preparations of breast-carcinoma. Anal Cell Pathol 1993;5:265–275. 6. Ji L, Tucker J. DNA measurement of overlapping cell nuclei in thick tissue sections. Anal Cell Pathol 1997;14:41– 49. 7. Baak JPA, Thunnissen FBJM, Oudejans CBM, Schipper NW. Potential clinical uses of laser scan microscopy. Appl Optics 1987;26:3413– 3416. 8. Rigaut JP, Vassy J, Herlin P, Duigou F, Masson E, Briane D, et al. 3-dimensional DNA image cytometry by confocal scanning laser microscopy in thick tissue blocks. Cytometry 1991;12:511–524. 9. Tekola P, Zhu Q, Baak JPA. Confocal laser microscopy and image processing for 3-dimensional microscopy — technical principles and an application to breast cancer. Hum Pathol 1994;25:12–21. 10. van Ginkel AHM, Baak JPA, Tekola P, Belien JAM, van Diest PJ. Confocal laser scanning microscopy: principles and applications in pathology. In: Kirkham N, Lemoine NR, editors. Progress in pathology. Edinburgh: Churchill Livingston; 1995. p 191–209. 11. Zhu QZ, Tekola P, Baak JPA, Belien JAM. Measurement by confocal laser-scanning microscopy of the volume of epidermal nuclei in thick skin sections. Anal Quant Cytol Histol 1994;16:145–152. 12. Tekola P, Baak JPA, Belien JAM, Brugghe J. Highly sensitive, speciﬁc, and stable new ﬂuorescent DNA stains for confocal laser microscopy and image processing of normal parafﬁn sections. Cytometry 1994; 17:191–195. 13. Tekola P, Baak JPA, van Ginkel AHM, Belien JAM, van Diest PJ, Broeckaert MAM, et al. Three-dimensional confocal laser scanning DNA ploidy cytometry in thick histological sections. J Pathol 1996; 180:214 –222. 14. Czader M, Liljeborg A, Auer G, Porwit A. Confocal 3-dimensional DNA image cytometry of thick tissue sections. Cytometry 1996;25:246 – 253. 15. Lockett SJ, Sudar D, Thompson CT, Pinkel D, Gray JW. Efﬁcient, interactive, and three-dimensional segmentation of cell nuclei in thick tissue sections. Cytometry 1998;31:275–286. 16. Roysam B, Ancin H, Bhattacharjya AK, Chisti MA, Seegal R, Turner JN. Algorithms for automated characterization of cell populations in thick specimens from 3-D confocal ﬂuorescence microscopy data. J Microsc 1994;173:115–126. 17. Ancin H, Roysam B, Dufresne TE, Chestnut MM, Ridder GM, Szarowski DH, et al. Advances in automated 3-D image analysis of cell populations imaged by confocal microscopy. Cytometry 1996;25: 221–234. 18. Irinopoulou T, Vassy J, Beil M, Nicolopoulou P, Encaoua D, Rigaut JP. Three-dimensional DNA image cytometry by confocal scanning laser microscopy in thick tissue blocks of prostatic lesions. Cytometry 1997; 27:99 –105. 19. Rodenacker K, Aubele M, Hutzler P, Adiga PSU. Groping for quantitative digital 3-D image analysis: an approach to quantitative ﬂuorescence in situ hybridization in thick tissue sections of prostate carcinoma. Anal Cell Pathol 1997;15:19 –29. 20. de Solorzano CO, Rodriguez EG, Jones A, Pinkel D, Gray JW, Sudar D, et al. Segmentation of confocal microscope images of cell nuclei in thick tissue sections. J Microsc 1999;193:212–226. 21. Sarti A, de Solorzano CO, Lockett S, Malladi R. A geometric model for 3-D confocal image analysis. IEEE Trans Biomed Eng 2000;47:1600 – 1609. 22. Adiga PSU, Chaudhuri BB. An efﬁcient method based on watershed and rule-based merging for segmentation of 3-D histopathological images. Pattern Recog 2001;34:1449 –1458. 23. Vincent L, Soille P. Watersheds in digital spaces — an efﬁcient algorithm based on immersion simulations. IEEE Trans Pattern Anal and Machine Intell 1991;13:583–598. 24. Mackin RW, Newton LM, Turner JN, Roysam B. Advances in highspeed, three-dimensional imaging and automated segmentation algorithms for thick and overlappped clusters in cytologic preparations — application to cervical smears. Anal Quant Cytol Histol 1998;20: 105–121. 25. Rigaut JP, Vassy J. High-resolution 3-dimensional images from confocal scanning laser microscopy — quantitative study and mathematical correction of the effects from bleaching and ﬂuorescence attenuation in depth. Anal Quant Cytol Histol 1991;13:223–232. 26. Glazer AN, Rye HS. Stable dye-DNA intercalation complexes as reagents for high-sensitivity ﬂuorescence detection. Nature 1992;359: 859 – 861. 27. Rye HS, Yue S, Wemmer DE, Quesada MA, Haugland RP, Mathies RA,

3D CLSM CONTOUR-BASED SEGMENTATION ALGORITHM

21

28.

29. 30. 31.

32. 33.

et al. Stable ﬂuorescent complexes of double-stranded DNA with bis-intercalating asymmetric cyanine dyes — properties and applications. Nucleic Acids Res 1992;20:2803–2812. Hell S, Reiner G, Cremer C, Stelzer EHK. Aberrations in confocal ﬂuorescence microscopy induced by mismatches in refractive-index. J Microsc 1993;169:391– 405. Ridler TW, Calvard S. Picture thresholding using an iterative selection method. IEEE Trans Syst Man Cybernet 1978;SMC-8:630 – 632. Brakenhoff GJ, Blom P, Barends P. Confocal scanning light microscopy with high aperture lenses. J Microsc 1979;117:219 –232. Brakenhoff GJ, van der Voort HTM, VanSpronsen EA, Linnemans WAM, Nanninga N. Three dimensional chromatin distribution in neuroblastoma nuclei shown by confocal scanning laser microscopy. Nature 1985;317:748 –749. Sheppard CJR. Axial resolution of confocal ﬂuorescence microscopy. J Microsc 1989;154:237–241. van Kempen GMP, van Vliet LJ, Verveer PJ, van der Voort HTM. A

34. 35. 36. 37.

38.

quantitative comparison of image restoration methods for confocal microscopy. J Microsc 1997;185:354 –365. Keller HE. Objective lenses for confocal microscopy. In: Pawley JB, editor. Handbook of biological confocal microscopy. New York: Plenum Press; 1990. p 77– 86. Pawley JB. Fundamental limits in confocal microscopy. In: Pawley JB, editor. Handbook of biological confocal microscopy. New York: Plenum Press; 1990. p 15–26. Visser TD, Oud JL, Brakenhoff GJ. Refractive-index and axial distance measurements in 3-D microscopy. Optik 1992;90:17–19. Tsien RY, Waggoner A. Fluorophores for confocal microscopy: photophysics and photochemistry. In: Pawley JB, editor. Handbook of biological confocal microscopy. New York: Plenum Press; 1990. p 169 –178. van Kempen GMP, van Vliet LJ. The inﬂuence of the regularization parameter and the ﬁrst estimate on the performance of Tikhonov regularized non-linear image restoration algorithms. J Microsc 2000; 198:63–75.

