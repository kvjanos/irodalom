MICROSCOPY RESEARCH AND TECHNIQUE 44:49–68 (1999)

Efficient Cell Segmentation Tool for Confocal Microscopy Tissue Images and Quantitative Evaluation of FISH Signals
P. S. UMESH ADIGA AND B. B. CHAUDHURI
Computer Vision and Pattern Recognition Unit, Indian Statistical Institute, Calcutta 700–035, India

Key words:

histopathological; confocal microscopy; cell nuclei; enhancement; segmentation; FISH signal

ABSTRACT In this paper we have presented a semi-automatic method for segmenting 3-D cell nuclei from tissue images obtained using Confocal Laser Scanning Microscope. This microscope can focus at different layers of the specimen and hence a stack of images giving a 3D representation can be obtained. The existing methods for segmenting the cells in 3-D confocal images are highly interactive and, hence, time consuming. We have developed an approach, where, given one segmented image-slice (optical section) of the set of confocal images, the remaining image-slices in the image stack can be automatically segmented in a layered approach. One of the image-slices in an image stack is considered as a representative image-slice. In this image-slice, overlapping boundary pixels are identiﬁed interactively while the remaining part of the cell boundary is marked using Laplacian of a Gaussian operator. This interactively traced portion of the boundary is considered as initial boundary for ﬁnding the overlapping boundary pixels in the neighboring image-slices. Simple basic search strategy is used for boundary search in the neighboring image-slices. The method minimizes the human interaction and is also found to be efficient and reasonably accurate. Some experimental results are presented to illustrate the usefulness of the technique. We have also given the application of our segmentation method to quantitative evaluation of ﬂuorescence in situ hybridization (FISH) signals. A brief comparative study of visual FISH signal evaluation and the FISH signal counting by automatic image analysis is also given.Microsc. Res. Tech. 44:49–68, 1999 Wiley-Liss, Inc. 1999. INTRODUCTION One of the main problems in complete automatic analysis of the volumetric histo-pathological images is the absence of user friendly image processing tools. Most of the research and development work in this regard is aimed at analysis of the two-dimensional (2-D) histological images. From the survey paper of Preston and Bartels (1988), one can ﬁnd many approaches on automatic image analysis of tissue images. Notable among them are Adelh et al., (1978), Mendelsohn et al. (1971), Prewitt (1972), Bengtson et al. (1977), and Yasnoff and Bacus (1984). Some of the recent studies on tissue image analysis are done by Choi (1996) and Nordin (1989) among others. But most of these works are on 2-D images of a thin specimen. Feature analysis based on the 2-D images may not give accurate results due to incomplete representation of the cell nuclei and other histological as well as malignant features. For any reliable evaluation based on the quantitative measure of the features, analysis of the tissue in three dimensions is needed. In molecular pathology morphological grading, staging, and tumor size is mainly used to assess the malignant potential of the cancer tumors. Besides these methods, new techniques like nucleic acid ﬂuorescence in Situ hybridization (FISH) is becoming increasingly important in diagnostic and research pathology. The number of FISH components indicates the gain (trisomy) or loss (monosomy) of certain base-sequences in deoxyribonucleic acid (DNA). The quantitative evalua1999 WILEY-LISS, INC.

tion of the loss or gain in DNA is helpful in qualitative diagnostic pathology. In the paper by Zitzelsberger et al. (1994), it has been shown that the trisomy of chromosome number 7 can be used as prognostic factor. This is because of correlation of trisomy of chromosome 7 with the development of lymph node metastasis and with grade of differentiation. Therefore, for improved diagnostic and prognostic values, quantitative evaluation of FISH signals is necessary. To guarantee a reproducible and unbiased signal count per cell nucleus and to accurately measure the morphological features, a whole cell nucleus in 3-D has to be inspected (Aubele et al., 1996; Rodenacker et al., 1997). The analysis of a single 2-D image of a thin section that does not represent a whole cell nucleus results in a wrong measurement of features like cell chromatin, morphological characters, and FISH signals. A confocal microscope provides the necessary 3-D images of the thick ﬂuorescent tissue specimen as a stack of optical sections. Confocal laser scanning microscopes (CLSM) are well suited for 3D imaging of the biological specimens (Cohen et al., 1994; Pawley, 1990). They can nondestructively image the structures within the specimen. It is possible to obtain images of specimens nearly 400 times thicker than the thickness of specimens used for conven-

*Correspondence to: B.B. Chaudhuri, Computer Vision and Pattern Recognition Unit, Indian Statistical Institute, 203, B. T. Road, Calcutta 700–035, India. E-mail: bbc@isical.ac.in Received 26 March 1998; accepted in revised form 9 September 1998

50

P.S. UMESH ADIGA AND B.B. CHAUDHURI

tional microscopy. Brieﬂy stated, the working principle of the confocal microscope is as follows. A sharp laser beam is focused on a particular plane of the thick tissue specimen. The reﬂected laser beam is modulated according to the tissue information in the respective focal plane. This beam is demodulated to construct the image of a corresponding plane of the tissue specimen. The focal plane is then varied to scan the specimen at another depth. In this way, a stack of images at different depths is produced giving a 3D representation. The confocal laser beam scanning microscope produces a 3-D image as a stack of thin optical sections of the specimen. Because of multiple section images, one can arrive at a volumetric representation of the thick tissue specimen. The main problem in the processing of volumetric images of a thick tissue specimen is the segmentation of the cell nuclei. The difficulty in segmenting cell nuclei from volumetric histo-pathological images arises due to several factors. The cells are touching each other, overlapping and irregularly arranged with no deﬁnite shape. The uneven illumination of the specimen due various factors such as absorption of the light by the specimen in layers above and below the focal plane, etc., highly textured cell chromatin, and presence of dense intra-cellular matters, causes problems for automatic image analysis. Also the optics of the microscope as well as image acquisition hardware noise adds to the difficulty. The low-level segmentation techniques such as edge detectors as well as simple region growing techniques are not sufficient for the complete segmentation of the histo-pathological images (Garbay, 1986). In this paper we have presented a semi-automatic method for extracting the surface of the cell nuclei in a tissue cross section from the multiple CLSM images and its application in quantitative evaluation of the FISH signals. Figure 1 is a block diagram of 3D image analysis steps used to segment the cells in a stack of CLSM images. One of the image slices in the image stack is chosen as a representative image slice. This representative image is ﬁrst subjected to a low-level edge detection process. We have used Mar-Hilderth edge detector (Marr and Hilderth, 1980) for this purpose. The resulting image slice, which represents the overall boundary of the tissue, is subjected to partial interactive segmentation to obtain the complete boundary contour for the cells. Next, the boundary information from the interactively segmented representative image slice is used to automatically segment its neighboring image slices. Active contour models or snakes (Kass et al., 1988) can also be used to segment the cell nuclei (Adiga and Chaudhuri, 1998b). The method presented here is simpler and needs less interactive initialization than in the case of the snake algorithm. The cell boundaries marked by a layered segmentation process is superimposed on the FISH signal channel to conﬁrm the membership of the FISH signals to the corresponding cell nucleus. Then, the FISH signals are identiﬁed based on selected features and counted. MATERIALS Ten- to 15 µm thick paraffin sections from routinely processed prostate cancer tissue were deparaffinized and rehydrated. -satellite DNA probes speciﬁc for the centromeric region of chromosome 7 were generated

from clone 680TA. DNA probe was labeled by nicktranslation with ﬂuorescein (FITC)-dUTP. The ﬂuorescence in situ hybridization (FISH) was performed according to Zitzelsberger et al. protocol (Zitzelsberger et al., 1994). After washing in PN-buffer, the nuclei were counterstained with propidium iodide (PI, Sigma, St. Louis, MO) and mounted with an antifade solution as described by Johnson protocol (Johnson et al., 1981). Staining procedure was performed according to Tekola protocol (Tekola et al., 1994). Representative tumor and non-tumor regions with visible FISH signals and wellpreserved nuclei were selected for acquisition by confocal microscope. IMAGE ACQUISITION Essential setup features for the acquisition of images in thick tissue section is as follows: Lens Zeiss (Thronwood, NY) PNF 100x, 1.3, zoom 2, realized by scanning unit. The scanned ﬁeld of 62.5 µm 62.5 µm is sampled to 256 256 pixels giving a pixel resolution of 0.25 µmin x and y direction. Excitation laser lines were selected according to the ﬂuorochromes used. For propidium iodide (PI) used as DNA counterstain and FITC labeled signals, both were excited by the Argon line 488 nm. Axial resolution of 0.5 µm can be achieved, keeping in mind that the confocal axial resolution of a lens with numerical aperture NA 1.3 is about the wavelength used, i.e.. 0.6 µm. The FITC emission (FISH signal)is associated with the green channel and the PI emission showing the morphology of the tissue is stored in the red channel of a multi spectral image displayed in RGB colors. In all the spectral channels, 0 gray value represents the darkest voxel while 255 gray value represents the white. IMAGE ANALYSIS Automatic analysis of complex volumetric images involves noise reduction, feature enhancement, segmentation, labeling, etc.. In the following section, we have described some of the conventional and heuristic methods used for noise reduction, image enhancement, and a novel approach for segmentation of 3-D cells. IMAGE ENHANCEMENT Image enhancement techniques are applied to avoid the errors due to the presence of noise and artifacts that are inherent to the CLSM. Standard image enhancement techniques such as window slicing, size and shape heuristics, surface crispening, and directional smoothing are mainly used as pre-processing tools. Window-slicing, which is also known as amplitude thresholding, is useful whenever the intensity feature sufficiently characterizes the object. A local threshold is automatically chosen by examining the histogram. For images with distinct background, it is possible to select the threshold from the gray level histogram using the mode method, i.e., by choosing the gray level that corresponds to the valley position in the histogram as threshold value. It is experimentally observed that the gray level histograms of the histopathological images we have used are unimodal. Hence, the valley may not be found in the histogram of the images. In such cases, it is often possible to deﬁne a good threshold at the shoulder of the histogram (Sahoo et al., 1988). Since both the valleys and the shoulder correspond to the

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

51

Fig. 1.

Steps of CLSM image analysis.

52

P.S. UMESH ADIGA AND B.B. CHAUDHURI

concavity in the histogram, the threshold can be chosen by concavity analysis (Rosenfeld and De La Torre, 1983). For all practical purposes, (µ k ) gives good threshold value where µ and are the mean and the standard deviation of the gray levels and k is the experimentally determined constant. If the mode point gray value is close to zero or the lowest gray value in the image, as shown in the Figure 2a, (µ k ) is the threshold point. If the mode point gray value is close 255 or the highest gray value in the image, as shown in Figure 2b, then (µ k ) is the threshold point. Once the threshold is chosen, all the pixels having gray value below the threshold are considered as background pixels and are assigned the lowest gray value, i.e., dark, while other pixels are kept undisturbed. Window-slicing may result in the appearance of small noisy objects in the background as well as holes in the cell chromatin. This is due to the presence of dark intra-cellular objects as well as dense inter-cellular matters. Such artifacts are removed as follows. The volume of the isolated objects is calculated. If the volume of the isolated objects is below the pre-deﬁned value, such objects are deﬁned as artifacts and removed. On the other hand, any background component surrounded by an object region is considered as hole. The size of the hole is measured. If the hole size is smaller than the pre-deﬁned threshold, then it is converted to object region by restoring the original gray values. Figure 3b and c show the result of window slicing and size ﬁltering on one of the image slices of the CLSM image stack shown in Figure 3a. The size ﬁltering of the image stack is followed by surface crispening. This is done by adding the gradient or a high pass signal to the image (Russ, 1995). Figure 3d shows the result of crispening. Simple averaging ﬁlter spreads the boundary of the cells while smoothing. This is an undesirable effect. To protect the edges while smoothing, we have used the directional smoothing technique (Jain, 1994). This technique not only protects the edges but also smoothes the spurious protrusions in the surface. Figure 4 schematically explains the process of directional smoothing. The average of gray value within the directional window is calculated separately for all the four directions of the 3 3 window. The maximum of the four values is the smoothed gray value of the corresponding pixel, i.e., if v(i, j; ) where 10, 45, 90, 1356, are average gray values calculated in four directions given as v(i, j; ) 1 N
(m,n W )

Fig. 2. image.

Threshold selection (a) For a dark image (b) For a bright

u(i

m, j

n)

tional smoothing is applied for each image slice in the image stack. Figure 3e and f show the result of simple spatial averaging and directional smoothing on one of the image slices. The edge preserving properties of the directional smoothing is evident from the results shown. SEGENTATION OF TISSUE IMAGES: A LAYERED APPROACH Detection of the Overall Boundary We have used Laplacian of a Gaussian (LoG) operator due to Marr and Hilderth (1980) for detecting the over all boundary. This operator combines Gaussian ﬁltering with discrete Laplacian, which eliminates much of noise before edge enhancement. In this approach, an image is ﬁrst convolved with a Gaussian ﬁlter. This step smoothes an image and reduces the noise. The isolated noise points and small structures are ﬁltered. Since smoothing will result in spreading of the edges, the edge detector considers as edges only those pixels that

Then a direction * is found such that v(i, j; *) max 5v(i, j; )6 for all Then v(i, j ) v(i, j; *) 50, 45,90,1356

gives the desired result. W is the 3 1 neighborhood in the direction having N ( 3) voxels in it. The direc-

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

53

Fig. 3. Image enhancement results (a) original image slice (b) After Window-slicing (c) After Size ﬁltering (d) After Crispening (e) After spatial averaging (f) After directional smoothing.

54

P.S. UMESH ADIGA AND B.B. CHAUDHURI

tion is used to segment the image slice above and below it in the image stack. In the layered segmentation process, we assume that the boundary of the cells in two neighboring image slices is located very close to each other. Now suppose that i th image cell boundary is completely marked. Then we process (i 1) th image and (i- 1) th image using the boundary information of the i th segmented image. The i th image slice boundary is virtually superimposed on (i 1) th and (i-1) th image slices in the image stack. The selected region surrounding this virtual boundary is searched for proper cell boundary of (i 1) th and (i 1) th image slices. SEARCH METHODS Searching for the actual boundary pixel along the normal vector of the initial boundary is a computation intensive process. When the cell shape varies considerably along the depth of the image stack, our assumption that the boundaries of the same cell signature in the neighboring image slices are very close to each other, may not hold good. In such cases we have to increase the search region to incorporate large areas along the normal vector so that optimal pixel position for the cell boundary falls within the search region. We have used simple basic line search strategy for boundary search. For each edge pixel vi where i 0, 1, . . . , n, of the virtually superposed contour the basic search technique restricts its search in the region n W i 1 Wi, where Wi contains voxels on the normal vector hi of the corresponding pixel i: Wi

Fig. 4. Directional smoothing technique (directional windows are shown by dotted lines. The 1’s denote weight to the pixels).

have locally maximum gradient. The window-sliced and enhanced image is subject to LoG operation. The result is the overall boundary of the cell clusters. The LoG operation fails to mark the cell boundary where the cells touch or overlap each other. This is because of the weak and uneven gradient magnitude at those locations. Any attempt to threshold the image at the lowest level to detect all the edge pixels results in too many noisy edges that are undesirable. (See Fig. 9b for the overall boundary of the tissue images as a result of LoG operation over the CLSM image stack.) We choose an image slice from the stack, called representative image, and segment the individual cells partially interactively. This boundary of the segmented representative image (RI) is used as a priori information for the segmentation of the cells in the images above and below RI in the stack of CLSM images. In this way segmented i th image guides the automatic segmentation of (i 1) th and (i 1) th image slice in the stack (Adiga et al., 1996). Representative Image Segmentation The representative image is chosen with the following considerations. The last few images are not clear due to optical problems inherent to the CLSM and hence are not worth processing. Of the rest, one image slice from the middle of the image stack is chosen as the representative image. The overall boundary of the window-sliced and enhanced version of this image is obtained by LoG operation. The undetected part of the boundary, such as where the cells are touching each other, is traced interactively using a mouse driven software. The segmented representative image forms the basis for the further automatic segmentation process by layered approach. Figure 5 shows the representative image slice before and after interactive segmentation. After marking the complete boundary of the cells in the representative image slice, its boundary informa-

5v

i

vi

khi; k (m 2 1) , . . . , 0, . . . (m 2 1)

6

assuming that m is odd without the loss of generality. In our case we have used m 2 that is the search region of each pixel in every stage considers only ﬁve pixels along the normal vector (as shown in Fig. 8f). When the axial resolution of the image stack is poor and/or the cells deform considerably from one image slice to another, we have to increase the search region, i.e., m should be increased to incorporate the global optima within the search region. One of the simple methods to reduce the computational complexity of search is to insert more image slices in the image stack by interpolation. This virtually increases the axial resolution, thereby decreasing the search region in each image slice. The result is also useful in 3D reconstruction of the cell surface. We have implemented a simple interpolation technique based on morphing for this purpose (Adiga and Chaudhuri, 1998a). We can also use stratiﬁed line search technique (Lai, 1994) for searching the large areas. We have used interpolation technique as it makes axial propagation of the boundary contour easier and the result can be used in 3D surface reconstruction for visualization purposes. INTERPOLATION FOR IMPROVING AXIAL RESOLUTION Consider a two-tone version of neighboring image slices j and ( j 1) as source images, where the object is

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

55

Fig. 5. Representative image slice segmentation (a) Original image slice (b) Overall boundary by LoG operator (c) Interactively segmented image.

represented by gray level 1 and background by 0. For creating an interpolated image slice between j and ( j 1), we have to choose some control points in the interpolated image slice towards which the source images are distorted for the purpose of morphing. It can be argued that if by some means we can get the overall boundary of the objects in the interpolated image slice, we can use these pixels of the overall boundary as control points and ﬁll the gray level within these boundary points using morphing or weighted averaging technique. The overall boundary of the objects in the interpolated image slice can be found by using simple logical operations as follows. The two-tone version of the neighboring image slices j and ( j ) are subject to pixel-to-pixel Ex-OR operation. The resulting image consists of the portion that is common to the objects in j and ( j 1) image slices. This is shown diagrammatically in Figure 6a. The medial axis of this image gives the boundary of the objects in the interpolated image slice that can be used as control points for the morphing purpose. If the objects in j and ( j 1) image slices are laterally shifted and/or deviate considerably in shape, then the resulting medial axis need not be continuous as shown in Figure 6b. To join the disconnected boundary, we have applied the following simple operation. The common portion of the boundary of the objects in j and ( j 1) image slices are obtained by pixel-to-pixel AND operation of the two corresponding boundary images. The overall boundary of the image slices is obtained by LoG operation as explained earlier. The result of the AND operation is added to the medial axis in the interpolated image slice by logical OR operation. This results in linking the broken contour. This is shown diagrammatically in Figure 6b. To ﬁll the intensity information, we have used morphing. In this the window-sliced version of source images, j and ( j 1) are distorted towards the position of the contour based control points in the interpolated image slice. Then, the two deformed images are blended with simple weighted averaging to generate the gray value for the pixels in interpolated image slice. Let Gj 5Ij0, Ij1, . . . .6 be the gray value of the object pixels in

5I( j 1)0, I( j 1)0, . . .6 are the source image j and G( j 1)0 gray value of the object pixels in source image ( j 1). Then, the gray value of object pixels in the interpolated image slice is obtained by waited averaging of the corresponding pixels in the two source images, which can be written as w1 Gj w2 G( j 1) /2w where wI, w2, and ware the constants that are calculated experimentally. In our experiment we have used all the weights as 1 that simpliﬁes the method to simple averaging. For the pixels that fall outside the boundary contour in the interpolated image slice, the gray value is given as zero. Figure 7 shows the result of interpolation by our method. Figure 7a and b are two consecutive images slices while Figure 7c is the image slice created by interpolation technique explained above. These interpolated image slices enhance the axial resolution of the image stack. Moreover, each interpolated image slice reduces the search region by half. LAYERED SEGMENTATION APPROACH The implementation of the layered segmentation method is described in few steps. In the ﬁrst step, the boundary information from the i th image slice is virtually superposed on (i 1) th image slice. Let E1 represent the set of edge pixels (edgels belonging to the overall boundary) of (i 1) th image obtained by Laplacian of a Gaussian operation. Let the superposed boundary pixels be represented by the set E2. In the second step, the neighborhood of pixels in E2 is searched along the normal vector. If a pixel of E1 is within a small neighborhood W ( 1 5) along the normal vector of E2, then that pixel is removed from the set E2. Let E3 be the set of remaining pixels in E2. In the third step, the pixels of the set E3 are considered as the initial edge pixel position for the overlapped and touching cell boundary search in (i 1) th image slice. The magnitude of the gradient for each pixel in neighborhood Wi of the pixels of E3 along the normal vector is calculated. The pixel position whose second derivative corresponds to zero crossing and the ﬁrst derivative shows a strong local gradient magnitude is considered as the boundary pixel. When all the neighborhood Wi corresponding to the voxels of E3 are treated,

56

P.S. UMESH ADIGA AND B.B. CHAUDHURI

Fig. 6. Interpolation by morphing (a) When the corresponding cell signatures are not laterally shifted (b) When the corresponding cell signatures are shifted or deviates considerably in shape.

then the processing of (i 1) th image is complete. Similarly, processing of (i-1) th image is done. Figure 8 shows diagrammatically, the process of search in layered segmentation. Figure 8a and b are the boundaries of i th and (i 1) th image slices where i th image slice is already segmented. Figure 8c shows the virtual superposition of Figure 8a over Figure 8b. Figure 8d shows the portion of initial location the boundary pixels belonging to overlapped and/or touch-

ing portion of the cells with a search region being marked in a gray shadow for only a few pixels. Figure 8e shows the result of layered segmentation and LoG combined to form complete boundary of the cells in (i 1) th image slice. The edge-pixel search technique is shown in Figure 8f. The arrows denote the direction of search that is along the normal vector of the initial pixel position shown as dark pixels in a window. The boundaries of the newly segmented image slices are

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

57

Fig. 7. Result of interpolation by morphing (a) Source image slice ( j ) (b) Source image slice ( j Result of interpolation by morphing.

1) (c)

used to segment their neighboring image slices, respectively. When we move from one image slice to another, we may come across some new cells. The newly appearing cells in the image stack are taken into consideration for segmentation as follows. If a new cell signature appears while processing, appearance of the new cell is suspected. If the next two slices support the evidence, then the appearance of a new cell is conﬁrmed. Otherwise, the signature is rejected as an artifact. The boundary of such a new cell is automatically taken care of by LoG and layered segmentation process. Figure 9 shows the result of layered segmentation over a CLSM image stack. Figure 9a shows the original image slices, Figure 9b shows the results of LoG operation for overall edge detection, and Figure 9c shows the result of layered segmentation. The ﬁnal boundary of the cell nuclei is overlaid on the original data set to isolate the cells. 3-D component labeling algorithm is used to label the cells uniquely. The image slices are scanned slice by slice. When an object voxel is found, a unique label is assigned to all the connected voxels with in the boundary of the corresponding object. Scanning is continued from the position where it was previously stopped, till a voxel belonging to a new cell is come across. The whole process is continued till all the cells are labeled. Figure 10a and b show the number of cells segmented and uniquely labeled before and after layered segmentation of the image stack. DELETION OF UNWANTED CELL NUCLEUS The unwanted cells are those that are not completely represented in the image stack. Cells that appear at the border of the image stack are usually not complete, i.e., truncated. To remove such cell nuclei, the ﬁrst and last image slice in the image stack are considered. If these image slices show any signature of the cell nuclei, then the size of the signature is calculated. If this size is above a predeﬁned size threshold, it shows a lateral truncation of the nuclei. The size threshold is chosen

experimentally. In our case, we have chosen size threshold as 625 voxels (25 25 pixel area). The cells having a signature bigger than 625 voxels in the ﬁrst and/or last image slice or that are touching the ﬁrst column or ﬁrst row in more than one image slice are deleted from the segmented image volume. Also the cells that are of no interest to a pathologist are deleted by clicking on such a cell and reading the corresponding label. The resulting image is subjected to 3-D re-labeling, and all the cells are labeled sequentially. Figure 10c shows a representative segmented image slice after deletion of the unwanted cell nuclei. The labeled image is used to conﬁrm the cell membership of the FISH signal in FISH counting process as explained below. SEGMENTATION AND COUNTING OF FISH SIGNALS The goal of quantitative FISH evaluation is to measure the pathological alterations, that is gain or loss of a particular chromosome in the cell nuclei. In the image volume, FISH signals appear as tiny objects consisting of high-intensity voxels extending to a few image slices and is located entirely within the cell nucleus. For a normal cell, the cell nucleus contains two FISH signals due to chromosome 7 and any variation in this number can be attributed to abnormal pathological status (Aubele et al., 1996). Counting the FISH signals depends on distinguishing them from noise and ascertaining their membership to a particular cell nucleus. Visual counting of the FISH signal is a difficult and cumbersome process since the only possible way to look inside a cell nucleus is by displaying the gallery of the images containing the cell and then counting the signal, keeping in mind the 3D nature of the FISH signal. The gallery around particular nuclei used to visually count the FISH signal is shown in Figure 11. From Figure 11 one can understand the difficulties in visual counting. Also the manual counting process is fatiguing, tedious, and time consuming. We have presented a simple and efficient method for the automatic segmentation and counting of the FISH signal.

58

P.S. UMESH ADIGA AND B.B. CHAUDHURI

Fig. 8. Search procedure in the layered segmentation approach (a) Boundary of the cells in processed ith image slice (b) Overall boundary of the cells in (i 1 ) th image slice obtained by LoG operator (c) Fig. (a) virtually superimposed on Fig. (b) (d) Overlapped and/or touching cell boundary in (i 1 ) th image slice (e) Result after searching for actual edgels in (i 1 ) th image slice (f) Directionof search.

FEATURE SELECTION Only those signals that conferred to the selected features and lie completely within the cell nucleus are considered for further processing. The broad region of interest in the FISH signal channel is deﬁned by putting all non-cellular regions into the background. This is done by using a priori information of the cellular region obtained by segmented tissue image. This helps

in conﬁrming the FISH signal’s membership to a particular cell nucleus as well as to avoid the noisy signals in the background. The signal inside the cell is identiﬁed by its features. Some of the features we have used for this purpose are 1. Size 2. Shape (three dimensional nature)

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

59

Fig. 8.

(Continued.)

3. 4. 5. 6.

Average intensity Relative intensity Location Number of intensity peaks within the signal

An approximate maximum and minimum size of the FISH signal is deﬁned experimentally with the help of a pathologist. The shape of the signal is its threedimensional nature. It has been observed that the FISH signals are 3D objects that occupy at least two consecutive image slices when the axial resolution of the image stack is less than or equal to half the lateral resolution. As we have acquired the images with the above resolution criteria, we have used the shape, i.e., three-dimensional nature of the signal as one of the features for identiﬁcation. A threshold for the average intensity of the signal is set experimentally. Relative intensity is the ratio between total intensity of the signal and the average of the total intensity of all the signals within the corresponding cell nucleus. Location of the signal is one of the important features. The signal is considered as authentic and belonging to a particular cell if it is lying completely within the cell nucleus or at least more than 50% of the voxels belonging to the signal lie within the corresponding cell nucleus. In an oversized signal caused due to the overlapping of two or more FISH signals, proper count can be taken by counting the number of intensity peaks within a signal and the distance between them. ERRORS IN FISH COUNTING During automatic counting of the FISH signals, due to noise or otherwise, there is possibility of erroneous count. Some of the main reasons for error are listed below. 1. 2. 3. 4. 5. 6. False identiﬁcation of FISH signal Missed and split FISH signals Overlapping FISH signals Debris caused due to improper specimen ﬁxation Error due to improper segmentation of cell nuclei Error due to wrong feature selection in identiﬁcation

False identiﬁcation of the signal occurs due to the presence of noisy artifacts in the image and improper segmentation. In such cases, the noisy signals in the immediate background of the cells are counted as FISH signals. Missed signal error occurs due to removal of weak signals as noise artifacts, over-segmentation of the cells, improper feature selection, etc. Split signal error and overlapping signal error are caused by poor image acquisition and wrong identiﬁcation of the signal features. Such cases are to be recognised and methods have to be evolved to obtain proper signal count. The debris is due to improper specimen ﬁxation, ﬂuorescent dyes, and air bubbles inside the specimen. These things are reﬂected as object voxels in the signal channel. Accurate segmentation and careful selection of the FISH signal features reduce the error in automatic counting of the signals. NOISE REMOVAL AND SIGNAL ENHANCEMENT We have used some conventional and heuristic methods such as symmetrical Gaussian smoothing, top-hat ﬁltering, size and shape heuristics to reduce the noise in the signal channel and to enhance the FISH signal features. GAUSSIAN SMOOTHING FISH signals are the localized features. Since the Gaussian smoothing does not give much signiﬁcance to the far away voxels while smoothing, it can be considered as one of the best noise reduction ﬁlter for signal channel. The 3-D Gaussian function is given as G(i, j, k) exp [ (i2 j2 k2)/2 2]. The degree of the Gaussian smoothing is characterized by . To simplify the computation we have used 2 2 in all directions. This makes it possible to do a tradeoff between blurring of the FISH signal and reduction in the noise level. Gaussian smoothing reduces the noise due to isolated voxels, noisy peaks, etc. It is inevitable that there will be some degree of blurring of the signals due to

Fig. 9. Results of the layered segmentation process (only few image slices are shown) (a) Original image slices (b) Result of LoG operation (c) Result after layered segmentation.

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

61

Fig. 9.

(Continued.)

Fig. 10. Result of labeling and deletion of unwanted cells (a) Labeled cells before layered segmentation (b) Labeled cells after layered segmentation (c) Cells after deletion of unwanted and truncated cell nuclei.

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

63

Fig. 11. Display for visual counting (a) Selection of cell of interest by drawing a box around the cell (b) Gallery of the image within the box for visual analysis of the FISH signal.

smoothing. The top-hat ﬁltering is used to enhance such blurred FISH signals. TOP-HAT FILTERING The top-hat ﬁlter is basically a point ﬁnder (Russ, 1995). We have used 3-D top-hat ﬁlter to enhance the

features of the FISH signals. Three dimensional tophat ﬁltering can be brieﬂy explained as follows. The ﬁlter consists of a C1 C2 C3 core voxels in a W1 W2 W3 window where Wi Ci for all i 1, 2, 3. This ﬁlter is centered on each voxel in the image. The top-hat method ﬁnds the maximum brightness in the larger

64

P.S. UMESH ADIGA AND B.B. CHAUDHURI

Fig. 12. (a) Image slices of the FISH signal channel (b) After rejecting all the signals in the non-cellular region (c) After Gaussian smoothing, top-hat ﬁltering and size ﬁltering (d) Conﬁrming the cell membership of the FISH signals.

surrounding region consisting of voxels belonging to and subtracts that from the brightest point in the interior core region. If the difference exceeds some predeﬁned threshold, then the corresponding voxel in the central crown is considered as belonging to FISH signal and is enhanced. The threshold is chosen as

(µw k) where µw is the average gray value of the window Wi and k is an experimentally determined constant. When there are two intensity peaks in a signal (due to overlapping) with a minimum deﬁned distance between them, then top-hat ﬁltering enhances both the intensity peaks. This reduces the error due to

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

65

Fig. 12.

(Continued.)

overlapping signals since it can be correctly counted by counting the number of intensity peaks in a signal. SIZE AND SHAPE FILTERING When there is a cluster of noisy voxels, smoothing and thresholding may result in making the noisy cluster in to a connected component. Some noisy spots may also pass as a FISH signal in 2-D image slice. A

single or a group of isolated noisy voxels may also cause errors in automatic counting of signals. Debris caused due to error in specimen ﬁxation, air bubbles, etc., will also be counted unless it is removed. Such noises are reduced by size and shape heuristics. It is known that the FISH signals are 3-D in nature and extend to several image slices in the image volume. The lateral spread of the signal is not more than a few voxels. We

66

P.S. UMESH ADIGA AND B.B. CHAUDHURI

Fig. 13. Graphical User Interface built for applying different types of segmentation techniques on CLSM tissue images and Quantitative FISH evaluation.

have deﬁned a size-and-shape ﬁlter to remove this kind of artifact. The maximum and minimum size of the signal are determined experimentally, in consultation with the pathologists. The objects that do not fall within the size criteria and deviate very much from the normal shape of the signal are subjected to further investigation. If the object component is less than the minimum deﬁned size of a signal, then it is considered an artifact. In case the signal size is more than the predeﬁned maximum size, then an overlap of the FISH signals is suspected. The number of intensity peaks in the object are counted. If there are more than one intensity peaks with a minimum deﬁned distance between them, then, overlapping of the signals is conﬁrmed. In such cases, the number of peak signals is counted as number of FISH signals. If there is only one intensity peak in the oversized object, such objects are considered as artifacts. Also the signals that do not occupy a minimum of two consecutive image slices as a connected component, are considered as artifacts and removed.

Figure 12 shows the effect of noise removal and overlaying the border of the cell nuclei on FISH signal channel. Figure 12a is the sequence of image slices of the unprocessed FISH signal channel. Figure 12b shows the selection of cellular region by suppressing all the signals outside the cells. Figure 12c shows signal channel after noise reduction and signal enhancement. The cell boundary is superimposed on the enhanced signal channel for counting purposes as shown in Figure 12d. SIGNAL COUNTING Those portions of the signal channel that belong to the cells of interest are considered for signal counting. The corresponding cell region obtained from the segmented tissue image is virtually mapped to the FISH signal channel. The 3-D component labeling similar to the one used in labeling the cells, is applied to the FISH signals in the selected region. The result of labeling the FISH signals also gives the maximum number of FISH

SEGMENTATION OF CLSM TISSUE IMAGES AND FISH

67
No. of cells selected 8

signals in the cell nucleus. The process is repeated for all the cells of interest and the FISH signals per cell nucleus are documented for further analysis. If Um is m th image data set of a tissue specimen containing N nuclei, and if there are j FISH signals in the i th nucleus, then it is documented as Um (i) j where i 1,2,...., N. For normal nuclei j 2. EXPERIMENTAL RESULTS AND DISCUSSION We have considered twenty-ﬁve image data sets from 14 patients for experiments. The FISH signals per nuclei are ﬁrst visually counted and documented. Visual counting is done with the help of a pathologist. A Graphical User Interface has been developed for segmentation, and different cyto and histological feature evaluation as well as FISH signal counting. Figure 13 shows the user interface. The software is developed using Interactive Data processing Language and INDY, IRIX 5.3, Silicon Graphics work station. All the results shown are inverted to highlight the object as a dark over a light background and scaled to to ﬁt into a required format. Layered segmentation involves the fusion of lowlevel edge detection such as LoG operation with the high-level search techniques. The major drawback of the method is that it is sensitive to noise since it blindly chooses the gradient maximal position within the search region as the suitable candidate for boundary pixel. To avoid the detection of a noisy peak as edge pixels, the search region should be large enough to encompass the global optima but too large a search region increases the total computation. The best option is to make use of more noise reduction and boundary enhancing techniques to avoid marking noisy peaks as cell boundary pixels. The high-level methods such as snakes can also be used for surface tracking (Adiga and Chaudhuri, 1998a,b). But snake algorithms are computationally complex and equally noise sensitive. One can say by experience that the most technically advanced algorithms are not necessarily the most useful for the segmentation of tissue images from the pathologist’s point of view. Another important result we have presented is the automatic FISH signal counting. The percentage of error in automatic detection and counting of signals in the experiments conducted by us is approximately 5 %. This is well within the acceptable level, considering the fact that there is no hard-and-fast rule for deﬁning a FISH signal. Moreover, the consistency in deﬁning the features of the FISH signals by different pathologists is also poor. Table 1 shows comparative results of visual counting and the automatic counting of the signals over six image data sets. Table 1 gives an insight about the reliability of the automatic counting methods. We have used interpolation to enhance the axial resolution of the image stack. Then the layered segmentation is applied to every image slice including the interpolated image slices. Though it is difficult to defend this method as far as the total amount of computation needed, this method has deﬁnite advantages in further processing stages such as surface reconstruction for 3-D visualization. The interpolation process is simple to understand and implement, compared to complex search techniques. Each interpolated image reduces the search region by half. If m is the size of the neighborhood for search, and there are n indepen-

TABLE 1. Results of visual and automatic FISH signal counting Sl. no. 1. Cell no. 1 2 3 4 5 6 7 8 1 2 3 4 5 1 2 3 4 5 6 1 2 3 4 5 1 2 3 4 5 6 7 1 2 3 4 Visual count 2 2 1 2 4 3 3 2 2 2 2 3 2 3 3 1 2 2 1 2 2 2 2 2 2 2 2 2 2 2 2 3 4 2 2 Automatic count 2 2 1 2 4 3 3 2 2 2 2 3 1 3 3 1 2 2 1 2 2 1 2 2 1 2 2 2 2 2 2 3 4 2 1

Material Higher grade malignant prostate tissue

2.

Lower grade malignant prostate tissue

5

3.

Higher grade malignant prostate tissue

6

4.

Lower grade prostate tissue

5

5.

Higher grade prostate tissue

7

6.

Higher grade prostate tissue

4

Total no. cells in six specimens Visual count Auto count
*Percentage of error 5%.

35 77 73*

dent pixel positions to search, the computational complexity of the basic line search can be given as O(nm3) (Lai, 1994). Also, since we search only for the touching portion of the cell nuclei, the total computation is minimized. ACKNOWLEDGMENTS The authors are thankful to the scientists especially Mr. Rodenacker and Dr. Hutzler of the Institute of Pathology, GSF, Munich, Germany, for providing the data. We also thank the anonymous reviewer for the suggestions and criticism that helped in revising this article. REFERENCES
Adelh D, Brugal G, Chassery TM, et al. 1978. Microscopic image analysis system : Applications to biology : Cell cycle cancerous blood and bonemarrow cells. Proc 4th Int Conf Patt Rec, Kyoto, Japan, p 864–871. Amini AA, Weymouth TE, Jain RC. 1990. Using dynamic programming for solving the variational problems in vision. IEEE Trans Patt Anal Mac Intell 12: 855–867. Anil KJ. 1995. Fundamentals of digital image processing. New Delhi: Prentice-Hall of India. Adiga PSU, Chaudhuri BB, Rodenacker K. 1996. Semi- automatic segmentation of confocal microscopy images. In: Proceedings of 13th

68

P.S. UMESH ADIGA AND B.B. CHAUDHURI
Marr D, Hilderth EC. 1980. Theory of edge detection. Proc R Soc Lond B 207:187–217. Mendelsohn ML, Mayall BH, Perry BH. 1971. Generalised grayness proﬁles applied to edge detection and the organization of chromosome images. In: Laughlin JS, Webster RW, editors. Advances in medical imaging. 327–345. Nordin B. 1989. Development of an automatic pre-screener for the early detection of cervical cancer : algorithms and implementation. Ph.D. Thesis. Dept. of Scientiﬁc Computing, Uppsala University, Sweden. Pawley J, editor. 1990. Handbook of confocal microscopy. London: Academic Press. Preston K Jr, Bartels PH. 1988. Automated image processing for cells and tissues. In: Newhouse VL, editor. Progress in medical imaging. New York: Springer Verlag, p 1–121. Prewitt JMS. 1972. Parametric and non-parametric recognition by computer: an application to leukocyte image processing. Adv Comput 12:285–414. Rodenacker K, Aubele M, Hutzler P, Umesh Adiga P S. 1997. Groping for quantitative digital 3-d image analysis : an approach to quantitative ﬂuorescence in situ hybridization in thick tissue sections of prostate carcinoma. Int J Anal Cell Pathol 15:19–29. Rosenfeld A, De La Torre P. 1983. Histogram concavity analysis as an aid in threshold selection. IEEE Trans Syst Man Cybernet 13:231– 235. Russ JC. 1995. Handbook of image processing, 2nd ed. London: CRC Press. Sahoo PK, Soltani S, Wong AKC, Chen YC. 1988. Survey: a servey of thresholding techniques. Int J Computer Vision Graphics Image Processing 41: 233–260. Tekola P, Baak JPA, Beli’’en JAM, Brugghe J. 1994. Highly sensitive, speciﬁc, and stable new ﬂuorescent DNA stains for confocal laser microscopy and image processing of normal paraffin sections, Cytometry 17:191–195. Yasnoff WA, Bacus JW. 1984. Scene segmentation algorithm development using error measures. Anal Quant Cytol 6:45–58. Zitzelsberger H, Szucs S, Weier H-U, Lehmann L, Braselmann H, ¨ Enders S, Schilling A, Breul J, Hoﬂer H, Bauchinger M. 1994. ¨ Numerical abnormalities of chromosome 7 in human prostate cancer detected by ﬂuorescence in situ hybridization (FISH) on paraffin-embedded tissue sections with centromere-speciﬁc DNA probes. J Pathol 172:325–335.

International Conference on Pattern Recognition, ICPR-96, Vienna, 4:494–497. Adiga PSU, Chaudhuri BB. 1998. Segmentation and counting of FISH signals in confocal microscopy images. MICRON Int J Microscopy Studies (in press). Adiga P S U, Chaudhuri BB. 1998a. Segmentation of 3-D histopathological images by surface following using constrained snakes. In: Proceedings of 14th International Conference on Pattern Recognition, ICPR-98, Brisbane, Australia (in press). Adiga PSU, Chaudhuri BB. 1998b. Segmentation of 3-D histopathological images using snakes and its application in quantitative evaluation of FISH signal. In: Proceedings of 2nd International Conference on Medical Image Understanding and Analysis, MIUA98, Leeds, UK (in press). Aubele M, Zitzelsberger H, Szucs S, et al. 1996. Comparative FISH analysis of numerical chromosome 7 abnormalities in 5 µm and 15 µm paraffin-embedded tissue sections from prostatic carcinoma. Int J Histochem. Bengtson E, Errickson O, Holmquist J, et al. 1977 . Low resolution segmentation of cervical cells, Report 77–3. Dept. Clin. Cytol, University Hospital, Uppsala, Sweden. Choi H-K. 1996 . New methods for image analysis of tissue sections, Ph.D. thesis. Centre for Image Analysis, Uppsala University, Sweden. Cohen AR, Roysam B, Turner JN. 1994. Automated tracing and volume measurements of neurons from 3-D confocal ﬂuorescence microscopy data., J Microsc 173:1–12. Dhingra K, Sneige N, Pandita TK, et al. 1994 . Quantitative analysis of chromosome in situ hybridization signal in paraffin embedded tissue sections. Cytometry 16:100–112. Garbay C. 1986. Image Structure Representation and Processing: A discussion of some segmentation methods in cytology, IEEE Transaction on Pattern Analysis and Machine Intelligence, 8:140–146. Jain AK. 1995. Fundamentals of Digital Image Processing. PrenticeHall India Pvt. Ltd. New Delhi. Johnson GD, de C Nogueira Araujo GM. 1981. A simple method of reducing the fading of immunoﬂuorescence during microscopy. Immunol Methods 43:349–350 Kass M, Witkin A, Teropoulos D. 1988. Snakes: active contour models. Proc First Int Conf Comp Vis 259–269. Lai K F. 1994. Deformable contours: modelling, extraction, detection and classiﬁcation. Ph.D. Thesis. Dept. of Electrical Engineering, University of Wisconsin-Madison.

