Nature Methods

Micropilot: automation of fluorescence microscopy–based imaging for systems biology
Christian Conrad, Annelie Wünsche, Tze Heng Tan, Jutta Bulkescher, Frank Sieckmann, Fatima Verissimo, Arthur Edelstein, Thomas Walter, Urban Liebel, Rainer Pepperkok & Jan Ellenberg

Supplementary Figure 1 Supplementary FIgure 2

Classifier training and measurements of HeLa-SEC31 cells. Example images and classification of the live H2B-tubulin HeLa cells (scrambled siRNAi).

Supplementary Figure 3

Classification and normal recovery rate distribution of the automatic FRAP on CBX1-EGFP cells.

Supplementary Table 1

Pseudo code examples for the different microscopic systems.

Note: Supplementary Software and Supplementary Videos 1–4 are available on the Nature Methods website.

Nature Methods: doi.10.1038/nmeth.1558

Supplementary Figure 1 Classifier training and measurements of YFP-SEC31 HeLa cells.

a
0
7,639

Predict

1

Training images

0

7,064

l 194

7,258

97.3 % Sensitivity

True

1

l 32

349 l

381

91.6 %
7,096 543

99.5 %

PPV 63.3 %

b
100 90 80 70

ERES spots

60 50 40 30 20 10 0 5 7 9 11 13 15 17 19 21

Nuclei distance [µm]

(a) Confusion matrix of the trained classifier shows true class assignments by human observer horizontally against the predicted vertically for the two different classes. At edges of the matrix the total numbers of the cell classes are given (overall total number in the left upper corner) corresponding to the PPV = TP / (TP + false positives) and the sensitivity = TP / (TP + false negatives). (b) Number of ERES of 91 high-resolution early anaphases to late telophases are plotted versus distance of nuclei (red rhombs correspond to nuclei in left and green rhombs to nuclei in right image in Fig 2c).

Nature Methods: doi.10.1038/nmeth.1558

Supplementary Figure 2 Example images and classification of the live H2B-tubulin HeLa cells (scrambled siRNAi).

a
0 Interphase or Artifact

b
3,644

Predict

0
2,517

1
l

2
76 l

3
l 14

4
83 l

5
Sensitivity (97 %)
l 17

0 1
3 Metaphase 2 Prometaphase 1 Prophase

4

2,711

89.5

0

73 l

0

0

0

0

73

100

True

2 3 4 5

l

1

0

170 l

l

2

0

0

173

98.3

0

0

0

177 l

l

1

0

178

98.2

0

0

0

l

1

255 l

l

3

259

98.4

l

2

0
77

0
246

0
194

l

4

244 l
264

250

97.6

2,520

343

0

20 40 60 80 100 %

%
100 80 60 40 20

99.8 /

96.1 69.1

91.2 74.3

92.4

4 Anaphase

0

PPV (87 %)

5 Telophase or Cytokinesis

c
System-a
Predict
3,000

System-b
Predict

1
0

2
188

3
136 l

4
116 l

5
48 l
488

3,002

1
l

2
102 l

3
82 l

4
60 l

5
44 l
295

0 1 2
True

Sensitivity (91.4 %)

0 1

7

Sensitivity (87.3 %)

l

9

l

2

0

l

1

0

12

75

39 l

l

9

0

l

4

0

52

75

0

353

l

3

l 12

0

368

95.9
True

2

0

276

l

6

l 17

l

1

300

92

3 4 5
%
100 80 60 40 20 0

0

l

6

256

l 12

l

1

275

93

3 4 5
%

0

l

5

136 l

32 l

0

173

78.6

0

l

2

l 11

488

l 17

518

94.2

0

l 11

l

7

646

l 26

690

93.6

0
9

0
551

l

2

l 14

1,323
1,389

1,339

98.8

0
46

0
403

l

1

41 l
800

1,450
1,521

1,492

97.1

408

643

0 20 40 60 80 100 %
100 80 60 40 20 0

232

0 20 40 60 80 100 %

100 75.9 64 62.7

95.2

95.3 84.8 68.5 58.6 80.1

PPV (79.6 %)

PPV (77.5 %)

Nature Methods:

(a) H2B-mCherry example images representing the heterogeneous default class interphase or artifact (index 0 or gray) with two different morphologies. The five depicted mitotic phases represent the class prophase (index 1 or purple), prometaphase (index 2 or turquoise), metaphase (index 3 or brown), anaphase (index 4 or blue), and telophase (index 5 or yellow). White bar represents 10 m. (b) Confusion matrix of the training results with SVM (Radial Base Function (RBF) kernel, RBF width = 0.1, penalty parameter = 16, ratio of class weights: 1:10:10:10:10:10) which shows true class assignments by human observer horizontally and predicted class assignment vertically for the six different classes. On the right and bottom edges of the matrix, the total numbers of the cell classes are given (overall total number in left upper corner). The graph on the bottom shows the PPV of the different classes. The bars on the right correspond to the sensitivity in percent, and the mean for both value sets is in parentheses. For training procedure, we enriched very rare phenotypes such as prophases (frequency < 1 %) or anaphases by selective cell picking using the ‘train+’-module in Micropilot. (c) Confusion matrices of the prediction results as described in (b) doi.10.1038/nmeth.1558 of confocal standard system-a and system-b using live cell samples made six months after training. Due to the high ratio of interphases to mitotic phases, the interphase (class 0) class was not predicted nor validated. The results from the offline training microscope (system-a) and the online control microscope (system-b) showed only a slight reduction of 4 % and 2 % for the mean class prediction sensitivity and PPV, respectively

Supplementary Figure 3 Classification and normal recovery rate distribution of the automatic FRAP on CBX1-EGFP cells.

a
0
4,607

Predict

1

0
5,000

Predict

1

Untrained images

Training images

0

4,479

36

4,515

0

4,972

2

4,974

True

True

99.2 %

99.9 %

Sensitivity

Sensitivity

1

2

90

92

1

4

22

26

97.8 %
4,481 126 4,976 24

84.6 %

99.9 %

PPV

71.4 %

98.9 %

PPV

91.6 %

b
15

Frequency

10

5

0 2 4 6 8 10

Recovery t 1/2 (s)

(a) Confusion matrix of the classification show true class assignments by human observer horizontally against the predicted vertically for the two different classes. At edges of the matrix the total numbers of the cell classes are given (overall total number in the left upper corner) corresponding to the PPV and the sensitivity. (b) Histogram of the t1/2 recovery of CBX1-EGFP of all prophase cells and the fitting of normal distribution for late (red) and early (blue) using normal mixture modeling.

Nature Methods: doi.10.1038/nmeth.1558

Supplementary Table 1

Pseudo code examples for different microscope systems.

Please read the tables step-by-step following the arrows according to the Fig. 1b.

(a) Synchronous (adhoc) communication using windows registry (similarly implemented for Zeiss 510, Olympus ScanR, or Perkin Elmer Ultraview).
Microscope
Write image path Set windows registry image path parameter after image capture in low-resolution: Software\ Settings\OnlineImageAnalysis\macro\path String Value = C:\repository\experiment_001\image-T001--Z01--C01.tif Listener on and wait Set the listener: Software\ Settings\OnlineImageAnalysis\macro\code String Value = 1 and wait Read listener Read every 150ms the windows registry key for new incoming images in: Software\ Settings\OnlineImageAnalysis\macro\code

Micropilot

Read Image If the listener parameter: Software\ Settings\OnlineImageAnalysis\macro\code String Value = 1

Then read: Software\ Settings\OnlineImageAnalysis\macro\path String Value = C:\repository\experiment_001\image-T001--Z01--C01.tif
Classification Classify image performing segmentation, feature extraction, and class prediction Continue prescan If listener: Software\ Settings\OnlineImageAnalysis\macro\code String Value = 0 Then capture the next image position and jump back to ‘Write image path’ Set listener If no positive cell found, set listener: Software\ Settings\OnlineImageAnalysis\macro\code String Value = 0 to skip position for complex imaging Else: Set xy-position offsets of the object of interest found relative to the image origin: Software\ Settings\OnlineImageAnalysis\macro\xoff String Value = 120 Software\ Settings\OnlineImageAnalysis\macro\yoff String Value = -240 Set listener for complex imaging: Software\ Settings\OnlineImageAnalysis\macro\code String Value = 2

Complex imaging If listener: Software\ Settings\OnlineImageAnalysis\macro\code String Value = 2 Read: Software\ Settings\OnlineImageAnalysis\macro\xoff String Value = 120 Software\ Settings\OnlineImageAnalysis\macro\yoff String Value = -240 Move accordingly to xy values and deploy predefined complex imaging. If finished go back to ‘Continue prescan’

Nature Methods: doi.10.1038/nmeth.1558

(b) Asynchronous (list) communication using socket (implemented for Leica SP5).
Leica SP5 (LAS/Matrix Screener)
Send image path CAM server sends image path after new image capture: /relpath:FinalerTest\MitoExperimente-2009_10_22_14_05_20\slide--S00\well--U00-V03\field--X03--Y00\image--L0000--S00--U00--V03-J00--X03--Y00--T0000--Z00--C00.ome.tif

Micropilot
Read image Read CAM command for image path at the specified address and port: /relpath:FinalerTest\MitoExperimente-2009_10_22_14_05_20\slide--S00\well--U00--V03\field-X03--Y00\image--L0000--S00--U00--V03--J00--X03-Y00--T0000--Z00--C00.ome.tif

(eventually filter out command if not applicable, e.g. autofocus images or complex imaging acquisition)
Continue prescan and go back to ‘Send image path’ Classification Perform segmentation, feature extraction, and class prediction.

Add position to list Listen to CAM add list commands and hold position list meanwhile

Send position If positive cell found send CAM command to add a position: /cli:CConrad /app:matrix /cmd:add /tar:camlist /exp:ipsfile /ext:none /slide:0 /wellx:0 /welly:3 /fieldx:3 /fieldy:0 /dxpos:120/dypos:-240 Execute list If maximum number of positive cells is reached Or If timer is down (counting from first positive cell found) Then send CAM start command with timelapse parameters: /cli:CConrad /app:matrix /cmd:startcamscan /runtime:600 /repeattime:60

Complex imaging Receive CAM start command and stop prescan to run complex imaging for list positions If finished jump back to ‘Continue prescan’

Clear list of position: cli:CConrad /app:matrix /cmd:deletelist

Nature Methods: doi.10.1038/nmeth.1558

(c) Synchronous (adhoc) communication using socket (implemented for µManager).
Micro-Manager
Prescan image Stop prescanning after image acquisition and wait

Micropilot
Start and stop Start prescan acquisition in the first cycle followed by immediate stop command: gui.acqControlWin_.runAcquisition(); acq.setPause(true); Invoke image path Invoke image path with beanshell command: print (acq.getLastImageFilePath());

Image path Print to socket: D:\cconrad\MM\Untitled_1\pos1\img_000000000_CFP_ 000.tif

Read Image D:\cconrad\MM\Untitled_1\pos1\img_000000000_CFP_0 00.tif Classification Perform segmentation, feature extraction, and class prediction. Complex imaging Either move to next position for acquisition Or Execute complex imaging defined by dataAcqDlg ("Complex imaging settings") Send command If no positive cell found: acq.setPause(false); Thread.sleep(100); acq.setPause(true); Jump back to prescan

Print to socket: True, if dataAcq is finished

Else: dataAcqDlg.RunAcquistion(); and invoke every 1000 ms: print(dataAcq.acqFinished_);
Invoke prescan If dataAcq.acq Finished = True Then: acq.setPause(false); Thread.sleep(100); acq.setPause(true); Jump back to prescan

Nature Methods: doi.10.1038/nmeth.1558

